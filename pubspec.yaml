name: devnotedekstop
publish_to: none
environment:
  sdk: ">=3.9.2 <4.0.0"

dev_dependencies:
  melos: ^7.1.0

workspace:
  - apps/dev_note
  - packages/models
  - packages/repositories

melos:
  scripts:
    analyze:
      description: Run analysis for all packages
      run: dart analyze .
      packageFilters:
        dirExists: lib

    test:
      description: Run tests for all packages
      run: dart test
      packageFilters:
        dirExists: test

    format:
      description: Format all packages
      run: dart format --set-exit-if-changed .

    clean:
      description: Clean all packages
      run: flutter clean
      packageFilters:
        flutter: true

    build:
      description: Run build_runner for all packages
      run: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner

    sync-deps:
      description: Synchronize dependencies across all packages
      run: melos bootstrap

    outdated:
      description: Check for outdated dependencies in all packages
      run: melos exec -- dart pub outdated

    upgrade-all:
      description: Sync all packages to use same latest dependency versions
      run: |
        echo "🔍 Finding and applying latest stable versions to all packages..."
        echo "📦 Updating dev dependencies..."
        melos exec -- dart pub add build_runner:^2.8.0 --dev || true
        melos exec -- dart pub add json_serializable:^6.11.1 --dev || true
        melos exec -- dart pub add freezed:^3.2.0 --dev || true
        melos exec -- dart pub add hive_ce_generator:^1.9.5 --dev || true
        melos exec -- dart pub add retrofit_generator:^10.0.5 --dev || true
        echo "📦 Updating main dependencies..."
        melos exec -- dart pub add freezed_annotation:^3.1.0 || true
        melos exec -- dart pub add json_annotation:^4.9.0 || true
        melos exec -- dart pub add dio:^5.9.0 || true
        melos exec -- dart pub add retrofit:^4.7.2 || true
        echo "🔄 Syncing workspace with new versions..."
        melos bootstrap
        echo "🎉 All packages now use same latest versions!"

dependency_overrides:
  build_runner: ^2.8.0
  build: ^4.0.0
  retrofit_generator: ^10.0.5
  freezed: ^3.2.3
  json_serializable: ^6.11.1
